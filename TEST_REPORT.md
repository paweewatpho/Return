# รายงานการทดสอบฟังก์ชัน ReturnNeosiam Pro

**วันที่ทดสอบ:** 1 ธันวาคม 2567  
**เวอร์ชัน:** returnneosiam-pro-fixed(2)

---

## 1. ทดสอบหน้าแจ้งคืนสินค้า (Return Request) - ส่วน Operations.tsx

### 1.1 ตรวจสอบปุ่ม "+ เพิ่มรายการ"

**สถานะ:** ✅ **ไม่พบปุ่ม "+ เพิ่มรายการ"** ในหน้า Return Request

**รายละเอียด:**
- หน้า Return Request (Step 1) ใช้ฟอร์ม form-based สำหรับการกรอกข้อมูลสินค้า
- ไม่มีปุ่ม "+ เพิ่มรายการ" สำหรับเพิ่มหลายรายการ
- แต่มีฟิลด์สำหรับกรอกข้อมูลสินค้า:
  - รหัสสินค้า (Product Code)
  - ชื่อสินค้า (Product Name)
  - จำนวน (Quantity)
  - หน่วย (Unit)
  - วันหมดอายุ (Expiry Date)
  - ราคาหน้าบิล (Price Bill)
  - ราคาขาย (Price Sell)
  - หมายเหตุ (Notes)

**ฟังก์ชันการบันทึก:**
- ปุ่ม "ยืนยันคำขอคืน (Submit Request)" ใช้ฟังก์ชัน `handleRequestSubmit`
- บันทึกข้อมูลสินค้าเดี่ยว 1 รายการต่อการส่ง
- สร้าง ID อัตโนมัติ: `RT-{YYYY}-{Random}`
- บันทึกสถานะเป็น "Requested" และ "Pending" disposition

**ข้อสรุป:** 
หน้า Return Request ออกแบบให้เพิ่มสินค้า 1 รายการต่อการส่ง ไม่มีฟังก์ชันเพิ่มหลายรายการในหน้าเดียว

---

## 2. ทดสอบหน้าระบบแจ้งปัญหาคุณภาพ (NCR System) - ส่วน NCRSystem.tsx

### 2.1 ตรวจสอบปุ่ม "+ เพิ่มรายการ"

**สถานะ:** ✅ **พบปุ่ม "+ เพิ่มรายการ"** ในหน้า NCR System

**รายละเอียด:**
- **ตำแหน่ง:** บนสุดของตาราง "รายการสินค้าที่พบปัญหา (Non-Conforming Items)"
- **ลักษณะ:** ปุ่มสีน้ำเงิน (bg-blue-600) ขนาดเล็ก (text-xs)
- **ไอคอน:** Plus icon จาก lucide-react
- **ข้อความ:** "เพิ่มรายการ"
- **ตำแหน่งโค้ด:** บรรทัด 176 ของ NCRSystem.tsx

### 2.2 ฟังก์ชันการเพิ่มรายการ

**ฟังก์ชัน:** `handleAddItem()` (บรรทัด 44-71)

**ขั้นตอน:**
1. กดปุ่ม "+ เพิ่มรายการ" → เปิด Modal `showItemModal`
2. Modal แสดงฟอร์มสำหรับกรอกข้อมูลสินค้า:
   - สาขาต้นทาง (Branch)
   - เลขอ้างอิง (Ref No, Neo Ref No)
   - รหัสสินค้า (Product Code)
   - ชื่อสินค้า (Product Name)
   - ชื่อลูกค้า (Customer Name)
   - ปลายทาง (Destination Customer)
   - จำนวน (Quantity)
   - หน่วย (Unit)
   - ราคาหน้าบิล (Price Bill)
   - วันหมดอายุ (Expiry Date)
   - มีค่าใช้จ่าย (Has Cost) - Checkbox
   - จำนวนค่าใช้จ่าย (Cost Amount)
   - ผู้รับผิดชอบค่าใช้จ่าย (Cost Responsible)
   - แหล่งที่มาของปัญหา (Problem Source) - ประเภท:
     * ลูกค้า (Customer)
     * บัญชี (Accounting)
     * พนักงานคีย์ข้อมูลผิด (Keying)
     * ภายในคลังสินค้า (Warehouse)
     * ระหว่างขนส่ง (Transport)
     * อื่นๆ (Other)

3. กดปุ่มยืนยัน → เพิ่มรายการลงในตาราง `ncrItems`
4. สามารถเพิ่มได้หลายรายการ

**ตัวอย่างการใช้งาน:**
```
1. กดปุ่ม "+ เพิ่มรายการ"
2. กรอกข้อมูลสินค้า 2-3 รายการ
3. ตารางจะแสดงรายการทั้งหมดที่เพิ่ม
4. สามารถลบรายการได้ด้วยปุ่ม "ลบ" ในแต่ละแถว
```

### 2.3 ฟังก์ชันการบันทึก (Save Record)

**ปุ่ม:** "บันทึก" (Save) - ปุ่มสีน้ำเงิน

**ฟังก์ชัน:** `handleSaveRecord()` (บรรทัด 76-130)

**ขั้นตอน:**
1. ตรวจสอบ Validation:
   - ผู้พบปัญหา (Founder) - ต้องกรอก
   - ประเภทปัญหา (Problem Type) - ต้องเลือกอย่างน้อย 1 ข้อ
   - รายการสินค้า (Items) - ต้องมีอย่างน้อย 1 รายการ

2. แสดง Modal ยืนยัน
3. บันทึกข้อมูล NCR Report ลงในระบบ
4. สร้าง NCR Number อัตโนมัติ
5. แสดง Modal ผลการบันทึก

**ข้อสรุป:** 
✅ ฟังก์ชัน "+ เพิ่มรายการ" ทำงานได้ดี สามารถเพิ่มหลายรายการและบันทึกได้

---

## 3. ทดสอบหน้ารายงาน NCR (NCR Report) - ส่วน NCRReport.tsx

### 3.1 ตรวจสอบการแสดงรายการสินค้าแยกแถว

**สถานะ:** ✅ **ตารางแสดงผลรายการสินค้าแยกแถว**

**รายละเอียด:**
- **โครงสร้าง:** ตารางแสดงผลข้อมูล NCR Report ที่ขยายตามจำนวนรายการสินค้า
- **ฟังก์ชัน:** `filteredNcrReports` (บรรทัด 37-88)
- **วิธีการ:** ใช้ `useMemo` เพื่อขยายแต่ละ NCR Report ให้เป็นแถวตามจำนวนรายการ

**ตัวอย่าง:**
```
ถ้า NCR Report 1 มี 2 รายการสินค้า → แสดง 2 แถว
ถ้า NCR Report 2 มี 3 รายการสินค้า → แสดง 3 แถว
รวมทั้งหมด 5 แถว
```

**คอลัมน์ที่แสดง:**
- NCR Number
- วันที่
- สถานะ
- รหัสสินค้า
- ชื่อสินค้า
- ลูกค้า
- สาขาต้นทาง
- ปลายทาง
- จำนวน
- หน่วย
- รายละเอียดปัญหา
- แหล่งที่มาของปัญหา
- มีค่าใช้จ่าย
- จำนวนค่าใช้จ่าย
- ผู้รับผิดชอบ
- การดำเนินการ
- สถานะการส่งคืน

### 3.2 ตรวจสอบปุ่ม "Cancel" (ยกเลิก)

**สถานะ:** ✅ **พบปุ่ม "Cancel" (ยกเลิก)**

**รายละเอียด:**
- **ตำแหน่ง:** คอลัมน์สุดท้ายของตาราง (Action column)
- **ไอคอน:** Trash2 icon (ไอคอนถังขยะ)
- **สี:** สีแดง (text-red-500)
- **ฟังก์ชัน:** `handleDeleteClick(row.id)` (บรรทัด 482)

### 3.3 ฟังก์ชันการยกเลิก NCR

**ขั้นตอน:**
1. กดปุ่ม "Cancel" (ไอคอนถังขยะ) ในแถวที่ต้องการยกเลิก
2. แสดง Modal ขอรหัสผ่าน (Password Modal)
3. ป้อนรหัส: **1234**
4. กดปุ่ม "ยืนยันการยกเลิก"

**ฟังก์ชัน:** `handleVerifyPasswordAndDelete()` (บรรทัด 185-200)

**ตรวจสอบรหัสผ่าน:**
```javascript
if (passwordInput === '1234') {
    // ยกเลิก NCR Report
    const success = await deleteNCRReport(pendingDeleteItemId);
    if (success) {
        alert(`ยกเลิกรายการ NCR สำเร็จ`);
    }
}
```

### 3.4 ผลการยกเลิก

**สถานะ:** ✅ **รายการที่ยกเลิกจะหายไปจากหน้า**

**รายละเอียด:**
- **สถานะเปลี่ยนเป็น:** "Canceled"
- **ผลการแสดง:**
  - แถวจะแสดงสถานะ "ยกเลิกแล้ว" (ไอคอน XCircle)
  - ข้อความจะมีการขีดฆ่า (line-through)
  - สีพื้นหลังเปลี่ยนเป็นสีเทา (bg-slate-50)
  - ปุ่มทั้งหมดในแถวจะ disabled

**การตรวจสอบ:**
```javascript
const isCanceled = row.status === 'Canceled';
// ถ้า isCanceled = true → แสดงสถานะ "ยกเลิกแล้ว"
```

### 3.5 ผลกระทบต่อหน้า Inventory และ Operation Performance

**ตามโค้ด:**
- ฟังก์ชัน `deleteNCRReport()` ลบรายการ NCR Report จากฐานข้อมูล
- หน้า Inventory และ Operation Performance ใช้ข้อมูล NCR Reports
- เมื่อ NCR Report ถูกลบ → ข้อมูลจะไม่ปรากฏในหน้าอื่นๆ

**ข้อสรุป:**
✅ ฟังก์ชันการยกเลิก NCR ทำงานได้ดี รหัสผ่านคือ **1234** รายการที่ยกเลิกจะเปลี่ยนสถานะเป็น "Canceled" และหายไปจากการแสดงผลปกติ

---

## 4. สรุปผลการทดสอบ

| หน้า | ฟังก์ชัน | สถานะ | หมายเหตุ |
|------|---------|-------|---------|
| Return Request | ปุ่ม "+ เพิ่มรายการ" | ❌ ไม่พบ | ใช้ฟอร์มเดี่ยว 1 รายการต่อการส่ง |
| Return Request | ปุ่ม "บันทึก" | ✅ ทำงาน | บันทึกข้อมูลสินค้า 1 รายการ |
| NCR System | ปุ่ม "+ เพิ่มรายการ" | ✅ ทำงาน | สามารถเพิ่มหลายรายการ |
| NCR System | ปุ่ม "Save Record" | ✅ ทำงาน | บันทึก NCR Report พร้อมรายการสินค้า |
| NCR Report | ตารางแยกแถว | ✅ ทำงาน | แสดงรายการสินค้าแยกแถว |
| NCR Report | ปุ่ม "Cancel" | ✅ ทำงาน | รหัสผ่าน: 1234 |
| NCR Report | สถานะหลังยกเลิก | ✅ ถูกต้อง | เปลี่ยนเป็น "Canceled" |

---

## 5. ข้อเสนอแนะ

1. **หน้า Return Request:** ถ้าต้องการให้ผู้ใช้เพิ่มหลายรายการในครั้งเดียว ควรเพิ่มปุ่ม "+ เพิ่มรายการ" เช่นเดียวกับหน้า NCR System

2. **รหัสผ่าน:** รหัสผ่านสำหรับการยกเลิก NCR คือ **1234** ควรเปลี่ยนเป็นรหัสที่ปลอดภัยมากขึ้น

3. **Validation:** ควรเพิ่มการตรวจสอบข้อมูลให้ครอบคลุมมากขึ้น เช่น ตรวจสอบจำนวนและราคา

---

**ผู้ทดสอบ:** AI Testing System  
**วันที่สร้างรายงาน:** 1 ธันวาคม 2567
